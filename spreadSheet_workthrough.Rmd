---
title: "Tidal Spreadsheet fun"
output: github_document

---

read in spreadsheet with tidyxl
```{r message=FALSE, warning=FALSE, paged.print=FALSE}

library(readr)
library(readxl)
library(tidyxl)
library(unpivotr)
library(tidyverse)

```

```{r}

# TODO Start with basic read in of spreadsheet and extracting the proper cells.
sheet <- "spreadsheets/Copy of Culvert37.xlsm" #IDEA perhaps build this as a shiny gadget to allow for pushing onto the web for others?


cells <- xlsx_cells(sheet) %>% 
  filter(is_blank == FALSE, sheet == "Data Sheet - SUMMARY") 
  
cells

```
There's a few issues (potential) that I've come across.  

* cells are merged which makes it hard to determine which cell actually contains the value of interest.  
* There are values that are selected using a formated control (like a dropdown) which can be very easily altered.  
  + accessing these values is best done through the *Data Sheet - SUMMARY* tab.  
* There appear to be cells with just spaces possibly? They are showing up as blank, but NOT empty. Unsure if this is an issue.

```{r}
characters <- cells[cells$data_type == "character", c("sheet", "address", "character")]
numerics <- cells[cells$data_type == "numeric", c("sheet", "address", "numeric")]

```
# Characters:
Below (and in extractedKey.xlsx) are extracted *character* values with their associated cell address. **NOTE:** Some of these cells may in fact be data values and not keys.

```{r}
characters
```

# Numerics:
Similar to the characters

```{r}

xlsx::write.xlsx(characters, file = "spreadsheets/extractedKey.xlsx", sheetName = "Likely keys") 
xlsx::write.xlsx(numerics, file = "spreadsheets/extractedKey.xlsx", sheetName = "Likely values", append = TRUE)

# Helper function to look up values in a cell of interest.
get.cell.value <- function(tidysheet, cellOfInterest){
  val <- tidysheet %>% filter(address == cellOfInterest)
  val[character,]
  
}
# 
# cells %>% filter(address == "G7")[]
#   
#   
#   get.cell.value("G7")
#   
  
```

